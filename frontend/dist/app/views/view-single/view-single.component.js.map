{"version":3,"file":"view-single.component.js","sourceRoot":"","sources":["view-single.component.ts"],"names":[],"mappings":"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","sourcesContent":["import {Component, OnInit} from '@angular/core';\nimport {Route} from \"@angular/router\";\nimport 'rxjs/add/operator/map'\n// import { RouteParams } from '@angular/router-deprecated/index';\nimport {CanDeactivate, OnActivate, Router, RouteSegment} from '@angular/router';\n\n\nimport {PointModel, ViewService, PointService} from \"../../shared\";\n\n@Component({\n    bindings: [ViewService, PointService],\n    moduleId: module.id,\n    selector: 'app-view-single',\n    templateUrl: 'view-single.component.html',\n    styleUrls: ['view-single.component.css']\n})\n\n\nexport class ViewSingleComponent {\n    lsPoints;\n    points;\n    id = 'route';\n    isWinVisible:boolean = false;\n    nameOfPoint;\n    descOfPoint;\n    newX;\n    newY;\n\n    constructor(params?:RouteSegment,\n                public viewService?:ViewService,\n                public pointService?:PointService) {\n        this.id = params.getParam('id');\n    }\n\n    getPoints() {\n        this.lsPoints = localStorage.getItem('view_points');\n\n        if (this.lsPoints != null) {\n            this.points = this.lsPoints;\n        }\n\n        this.pointService.getPointsOfView(this.id)\n            .subscribe(\n                data => {\n                    this.points = data;\n                    this.lsPoints = this.points;\n                },\n                error => console.error('Error: ' + error[0]),\n                () => {\n                }\n            );\n    }\n\n    closeWindow(e):void {\n        this.isWinVisible = !this.isWinVisible;\n        this.nameOfPoint = null;\n        this.descOfPoint = null;\n        this.newX = null;\n        this.newY = null;\n    }\n\n    showWindow(e):void {\n        this.isWinVisible = !this.isWinVisible;\n\n        this.newX = e.layerX;\n        this.newY = e.layerY;\n    }\n\n    onImageClick(e) {\n\n    }\n\n    preparePoint(newX, newY) {\n        var point = {\n            x: newX,\n            y: newY,\n            viewID: this.id,\n            name: this.nameOfPoint,\n            isOpened: true,\n            description: this.descOfPoint,\n            createdBy: '5728620832237db8158e161e'\n        };\n\n        return point;\n    }\n\n    createPoint(e) {\n        var point = {\n            x: this.newX,\n            y: this.newY,\n            viewID: this.id,\n            name: this.nameOfPoint,\n            isOpened: true,\n            description: this.descOfPoint,\n            createdBy: '5728620832237db8158e161e'\n        }\n\n        console.log(point);\n\n        // Push element to global array and draw it!\n        // this.points.push(point);\n        // console.log(point);\n\n        // Send to server\n        this.viewService.setPoint(point)\n            .subscribe(\n                data => {\n                    // TODO Synchronize with localstorage\n                    console.log(data);\n                    this.points.push(point);\n                    this.closeWindow(null);\n                },\n                error => console.log('Error: ' + error[0]),\n                () => {\n                }\n            );\n    }\n\n    openPoint(e) {\n        e.preventDefault();\n        let idOfElement = e.currentTarget.dataset.id;\n        this.viewService.openPoint({_id: idOfElement})\n            .subscribe(\n                data => {\n                    this.points.forEach(function (el, index) {\n                        if (el._id == idOfElement) {\n                            el.isOpened = true;\n                        }\n                    });\n                    console.log(data)\n                },\n                error => console.log(\"ERROR: \" + error[0])\n            );\n    }\n\n    closePoint(e) {\n        e.preventDefault();\n        let idOfElement = e.currentTarget.dataset.id;\n        this.viewService.closePoint({_id: idOfElement})\n            .subscribe(\n                data => {\n                    this.points.forEach(function (el, index) {\n                        if (el._id == idOfElement) {\n                            el.isOpened = false;\n                        }\n                    });\n                    console.log(data)\n                },\n                error => console.log(\"ERROR: \" + error[0])\n            );\n    }\n\n    deletePoint(event) {\n        event.preventDefault();\n        var elId = event.target.dataset.id,\n            idInArray = null,\n            i = null;\n\n        this.viewService\n            .removePoint({_id: event.target.dataset.id})\n            .subscribe(\n                data => {\n                    this.points.forEach(function (el, index) {\n                        if (el._id == event.target.dataset.id) {\n                            i = index;\n                        }\n                    });\n\n                    this.points.splice(i, 1);\n\n                    // TODO Synchronize with localstorage\n                },\n                error => console.log('Error: ' + error[0]),\n                () => {\n                }\n            );\n    }\n\n    // TODO Update method!!! Currently it only removes the element\n    updatePoint(event) {\n        var elId = event.target.dataset.id,\n            idInArray = null;\n\n        // Check index of element\n        this.points.forEach(function (el, index) {\n            if (el._id == elId) {\n                idInArray = index;\n            }\n        });\n\n        // Remove element with index\n        this.points.splice(idInArray, 1);\n\n        this.viewService\n            .removePoint({_id: event.target.dataset.id})\n            .subscribe(\n                data => {\n                    // TODO Synchronize with localstorage\n                },\n                error => console.log('Error: ' + error[0]),\n                () => {\n                }\n            );\n    }\n\n\n    rightMenuShowDetails() {\n\n    }\n\n    ngOnInit() {\n        this.getPoints();\n    }\n}"]}